<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KamsBurg ‚Äî Moje rezerwacje</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
         background:#f5f5f5;margin:0;color:#333}
    .container{max-width:800px;margin:0 auto;padding:20px}
    header{background:#2c3e50;color:#fff;padding:1rem;text-align:center;
           box-shadow:0 2px 5px rgba(0,0,0,.1)}
    h1{margin:0;font-weight:500}
    .card{background:#fff;padding:1.5rem;border-radius:10px;
          box-shadow:0 2px 10px rgba(0,0,0,.1);margin-top:20px}
    label{display:block;font-weight:600;margin-bottom:5px}
    input{width:100%;padding:.7rem;border:1px solid #ccc;border-radius:6px;
          margin-bottom:1rem;font-size:1rem}
    button{padding:.7rem 1.2rem;border:none;border-radius:6px;
           background:#3498db;color:#fff;font-weight:600;cursor:pointer}
    button:hover{background:#2980b9}
    button:disabled{background:#ccc;cursor:not-allowed}
    .reservation{border:1px solid #ddd;border-radius:8px;padding:1rem;margin-bottom:1rem}
    .reservation h3{margin:.2rem 0}
    .reservation small{color:#666}
    .cancel-btn{margin-top:.5rem;background:#e74c3c}
    .cancel-btn:hover{background:#c0392b}
    .msg{margin-top:1rem;padding:1rem;border-radius:8px;display:none}
    .msg.success{background:#d4edda;color:#155724}
    .msg.error{background:#f8d7da;color:#721c24}
  </style>
</head>
<body>
<header>
  <h1>Sprawd≈∫ swoje rezerwacje</h1>
</header>
<main class="container">
  <div class="card">
    <label for="email">Podaj sw√≥j e-mail:</label>
    <input type="email" id="email" placeholder="twoj@email.pl" required/>
    <button id="searchBtn">üîé Poka≈º rezerwacje</button>
    <div id="message" class="msg"></div>
  </div>

  <div class="card" id="results" style="display:none">
    <h2>Twoje rezerwacje</h2>
    <div id="list"></div>
  </div>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, get, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAOIXtjM9PMFXa0YFZfiDpfXlq_5sKxjv8",
    authDomain: "systemrezerwacji-dbd7c.firebaseapp.com",
    databaseURL: "https://systemrezerwacji-dbd7c-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "systemrezerwacji-dbd7c",
    storageBucket: "systemrezerwacji-dbd7c.firebasestorage.app",
    messagingSenderId: "1018043438907",
    appId: "1:1018043438907:web:d9b9e9190bd189dc2b491e",
    measurementId: "G-YXB460ZGR1"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const emailEl = document.getElementById("email");
  const btn = document.getElementById("searchBtn");
  const msg = document.getElementById("message");
  const list = document.getElementById("list");
  const results = document.getElementById("results");

  btn.addEventListener("click", async ()=>{
    const email = emailEl.value.trim().toLowerCase();
    if(!email){ showMsg("Podaj e-mail.","error"); return; }

    btn.disabled=true; showMsg("Szukam rezerwacji...","info");
    list.innerHTML=""; results.style.display="none";

    try{
      const snap = await get(ref(db,"reservations"));
      if(!snap.exists()){ showMsg("Brak rezerwacji w systemie.","error"); btn.disabled=false; return; }
      const all = snap.val();
      let found = [];

      for(const date of Object.keys(all)){
        for(const id of Object.keys(all[date])){
          const r = all[date][id];
          if((r.email||"").toLowerCase()===email){
            found.push({id,date,...r});
          }
        }
      }

      if(found.length===0){
        showMsg("Nie znaleziono rezerwacji dla podanego e-maila.","error");
      }else{
        results.style.display="block"; msg.style.display="none";
        list.innerHTML = found.map(r=>`
          <div class="reservation">
            <h3>${r.date} ‚Ä¢ ${r.hour}:00</h3>
            <small>${r.firstName} ${r.lastName}, ${r.people} os√≥b ‚Ä¢ stolik ${r.tableNumber}</small><br/>
            <small>Tel: ${r.phone}, Email: ${r.email}</small><br/>
            <button class="cancel-btn" data-date="${r.date}" data-id="${r.id}">üóëÔ∏è Anuluj</button>
          </div>
        `).join("");
      }
    }catch(e){
      console.error(e);
      showMsg("B≈ÇƒÖd pobierania danych.","error");
    }
    btn.disabled=false;
  });

  list.addEventListener("click", async (e)=>{
    if(e.target.classList.contains("cancel-btn")){
      const date = e.target.dataset.date;
      const id   = e.target.dataset.id;
      if(!confirm("Na pewno anulowaƒá tƒô rezerwacjƒô?")) return;
      try{
        await remove(ref(db,`reservations/${date}/${id}`));
        e.target.parentElement.remove();
        showMsg("Rezerwacja anulowana.","success");
      }catch(err){
        console.error(err);
        showMsg("Nie uda≈Ço siƒô anulowaƒá.","error");
      }
    }
  });

  function showMsg(text,type){
    msg.textContent=text;
    msg.className="msg "+type;
    msg.style.display="block";
  }
</script>
</body>
</html>
